<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width,height=device-height, user-scalable=no,initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="x5-fullscreen" content="true">
    <meta name="full-screen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" href="css/payment.css"/>
    <title>扫码支付</title>
</head>
<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/rem.js"></script>
<script src="js/vue.js"></script>
<body id="by">
<div id="app">
    <header>
        <span>{{level.level_name}}({{level.discount}}折)</span>
        <span>充值余额:￥{{userinfo.amount}}</span>
    </header>
<article>
    <p>{{userinfo.shopinfo}}</p>
    <div>
        <form action="" method="get">
            <div class="amount">
                <input  type="text" class="mrn" maxlength="10" placeholder="金额" readOnly="true"  onfocus="this.blur()"/>
                <div class="pric">￥<i class="price" >{{price}}</i><span><i class="cursor ">|</i></span></div>
                <span>随机立减</span>
            </div>
            <div class="yh">
                <div class="yhq">
                   <span>优惠券</span> <p id="yhq" ></p>
                </div>
                <div class="vip"><span>VIP</span>本店支持会员充值 </div>
            </div>

            <div class="keyboard">
                <div class="number">
                    <button type="button" v-on:click="button('1')">1</button>
                    <button type="button" v-on:click="button('2')">2</button>
                    <button type="button" v-on:click="button('3')">3</button>
                    <button type="button" v-on:click="button('4')">4</button>
                    <button type="button" v-on:click="button('5')">5</button>
                    <button type="button" v-on:click="button('6')">6</button>
                    <button type="button" v-on:click="button('7')">7</button>
                    <button type="button" v-on:click="button('8')">8</button>
                    <button type="button" v-on:click="button('9')">9</button>
                    <button type="button" v-on:click="button('00')">00</button>
                    <button type="button" v-on:click="button('0')">0</button>
                    <button type="button" v-on:click="button('.')">.</button>
                </div>
                <div class="function">
                    <button class="delete" type="button" v-on:click="delet"></button>
                    <a class="payment" href="javascript:;" v-on:click="payment">支付<br>
                    <i id="price">{{total}}</i><br>元 </a>
                </div>
            </div>
        </form>
    </div>
</article>

<div class="mask" id="masking">
    <div class="coupon">
        <p class="title">选择优惠券</p>
        <ul>
            <li v-for="coups in userinfo.couponlist" v-on:click="coupon(coups.condition,coups.price)">
               <span class="coupon_con">
                   {{coups.name}}优惠券
                   <i>满￥{{coups.condition}}可用</i>
               </span>
                <i class="coupon_pric">￥{{coups.price}}</i>
            </li>
        </ul>
    </div>
</div>
</div>
<script>
    var app = new Vue({
        el: '#app',
        data: {
            userinfo:[],
            level:[],
            price:"0",
            balance:0,
            condition:0,
            Coupon:0
        },
        computed:{
            aymentp:function(){
                console.log(this.userinfo)
            },
            total:function(){
                var total;
                if(this.price>=this.condition){
                    total=(this.price*this.level.discount/10-this.Coupon).toFixed(2);
                }else{
                    total=(this.price*this.level.discount/10).toFixed(2);
                }
              return  total;
            }
        },
        // doem事件在 `methods` 对象中定义方法
        methods: {
            button:function(number){
                var re = /.*\..*/;
                var price = $(".price").text();
                var current =number;
                if(this.price=='0'){
                    console.log(123)
                    if(current == '0' || current == '00'){
                        return;
                    }
                    if(current == '.'){
                        this.price+=current;
                    }else{
                        this.price=current;
                    }
                }else if(re.test(this.price) && current == '.'){
                    console.log(1)
                    return;
                }else{
                    this.price+=current;
                    console.log( this.price)
                }
            },
            //删除功能键
            delet:function(){
                var str= this.price;
                var newstr=str.substring(0,str.length-1);
                if(newstr == ''){
                    newstr = '0';
                }
              this.price=newstr;
            },
            //优惠券选择
            coupon:function(condition,price){
                $("#yhq").html("-￥"+price);
                this.Coupon=price;
                this.condition=condition;
            },
            payment:function(){
                var price=parseInt($("#price").text());
                var amount=this.userinfo.amount;
                // console.log(amount)
                //console.log(price);
                if(this.price==0){
                    alert("输入金额必须大于0")
                }
                if(this.price<=amount){
                        console.log(amount-price);
                    this.price="0";
                }
                else{
                    this.price="0";
                }

            }
        }
    });

    $.getJSON('js/user.json', function(res){
        app.userinfo=res[0].user[0];
        app.level=res[0].user[0].level;
        console.log(res[0].user[0].level)
        console.log(res[0].user[0].couponlist);

    });
    app.aymentp
    $(".payment").click(function(){
       var price=$("#price").text();
    //    console.log(parseInt(price));

    });
    //光标闪烁动画
    var twinkle
    function  startTimer(){
        twinkle=setInterval(function(){
            $(".cursor").toggle()
        },900);
    };
    function stopTimer()
    {
       clearInterval(twinkle);
    }
    startTimer();
    $(".amount").click(function(){
        startTimer();
        console.log(111111);
    });
    //    点击优惠券打开优惠券弹窗
    $(".yhq").click(function(e){
        $("#masking").show()
        stopTimer();
//        clearInterval(twinkle);
        $(".cursor").hide();
    });
    //    点击内容以外隐藏优惠券
    $("#masking").click(function(e){
            var oDragHandle = document.getElementById&&document.all ? event.srcElement : e.target;
            if(oDragHandle.id =="masking"){
                $(this).hide();
            }
        });


    $("#by").click(function(e){
        clearInterval(twinkle);

    });
    //点击优惠券
    $(".coupon").on("click","li",function(){
       // console.log(1)

        //$("#yhq").html("-"+$(this).find(".coupon_pric").text());
        $("#masking").hide();
        $(this).siblings('li').removeClass('liys');
        $(this).addClass("liys");
    });
    //数字键盘点击事件
    /*    $(".number").on("click", "button", function () {
     var num="";
     var re = /.*\..*!/;
     var price = $(".price").text();
     var current = $(this).text();
     if(price == '0'){
     if(current == 0 || current == '00'){
     return;
     }
     if(current == '.'){
     $(".price").append(current);
     var prics= parseInt($(".price").text());
     var level= parseInt($(".level").text());
     var yhq=parseInt($("#yhq").text());
     var total= prics*level/10;
     $("#price").html(total);
     }else{
     $(".price").text(current);
     $("#price").text(current);
     }
     }else if(re.test(price) && current == '.'){
     return;
     }else{
     $(".price").append(current);
     var prics= parseInt($(".price").text());
     var level= parseInt($(".level").text());
     var src=$("#yhq").val();
     var yhjprc=src.replace(/[^0-9]/ig,"");
     var yhq=parseInt(yhjprc);
     console.log(yhq)
     var total= prics*level/10;
     $("#price").html(total);
     }
     });*/

    //    删除功能键
    //    $(".delete").click(function(){
    //        var str= $(".price").text()
    //        var newstr=str.substring(0,str.length-1);
    //        if(newstr == ''){
    //            newstr = '0';
    //        }
    //        $(".price").html(newstr);
    //        $("#price").html(newstr)
    //    });
</script>
</body>
<script>

</script>
</html>
